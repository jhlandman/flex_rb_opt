<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Overview of risk-based portfolios | Flexible risk-based portfolio optimisation (Github link)</title>
  <meta name="description" content="Flexible risk-based portfolio optimisation
<a href="https://github.com/jhlandman/flex_rb_opt"><em>(Github link)</em></a>" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Overview of risk-based portfolios | Flexible risk-based portfolio optimisation (Github link)" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="jhlandman/flex_rb_opt" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Overview of risk-based portfolios | Flexible risk-based portfolio optimisation (Github link)" />
  
  
  



<meta name="date" content="2020-08-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="genframework.html"/>
<link rel="next" href="estriskreduce.html"/>
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="book_assets/header-attrs-2.3/header-attrs.js"></script>
<script src="book_assets/jquery-2.2.3/jquery.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="book_assets/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="genframework.html"><a href="genframework.html"><i class="fa fa-check"></i><b>3</b> A framework for constructing risk-based portfolios</a>
<ul>
<li class="chapter" data-level="3.1" data-path="genframework.html"><a href="genframework.html#mpt"><i class="fa fa-check"></i><b>3.1</b> An overview of modern portfolio theory</a></li>
<li class="chapter" data-level="3.2" data-path="genframework.html"><a href="genframework.html#introducing-risk-based-investing"><i class="fa fa-check"></i><b>3.2</b> Introducing risk-based investing</a></li>
<li class="chapter" data-level="3.3" data-path="genframework.html"><a href="genframework.html#improving-risk-based-portfolios"><i class="fa fa-check"></i><b>3.3</b> Improving risk-based portfolios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rbportch.html"><a href="rbportch.html"><i class="fa fa-check"></i><b>4</b> Overview of risk-based portfolios</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rbportch.html"><a href="rbportch.html#risk-based-portfolio-types"><i class="fa fa-check"></i><b>4.1</b> Risk-based portfolio types</a></li>
<li class="chapter" data-level="4.2" data-path="rbportch.html"><a href="rbportch.html#risk-based-portfolio-properties"><i class="fa fa-check"></i><b>4.2</b> Risk-based portfolio properties</a></li>
<li class="chapter" data-level="4.3" data-path="rbportch.html"><a href="rbportch.html#code"><i class="fa fa-check"></i><b>4.3</b> Code</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rbportch.html"><a href="rbportch.html#mw-portfolio"><i class="fa fa-check"></i><b>4.3.1</b> MW portfolio</a></li>
<li class="chapter" data-level="4.3.2" data-path="rbportch.html"><a href="rbportch.html#ew-portfolio"><i class="fa fa-check"></i><b>4.3.2</b> EW portfolio</a></li>
<li class="chapter" data-level="4.3.3" data-path="rbportch.html"><a href="rbportch.html#gmv-portfolio"><i class="fa fa-check"></i><b>4.3.3</b> GMV portfolio</a></li>
<li class="chapter" data-level="4.3.4" data-path="rbportch.html"><a href="rbportch.html#erc-portfolio"><i class="fa fa-check"></i><b>4.3.4</b> ERC portfolio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="estriskreduce.html"><a href="estriskreduce.html"><i class="fa fa-check"></i><b>5</b> Estimation risk reduction techniques</a>
<ul>
<li class="chapter" data-level="5.1" data-path="estriskreduce.html"><a href="estriskreduce.html#improving-optimisation-inputs"><i class="fa fa-check"></i><b>5.1</b> Improving optimisation inputs</a></li>
<li class="chapter" data-level="5.2" data-path="estriskreduce.html"><a href="estriskreduce.html#penalising-the-optimization"><i class="fa fa-check"></i><b>5.2</b> Penalising the optimization</a></li>
<li class="chapter" data-level="5.3" data-path="estriskreduce.html"><a href="estriskreduce.html#alternate-implementation-methods"><i class="fa fa-check"></i><b>5.3</b> Alternate implementation methods</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="somemaths.html"><a href="somemaths.html"><i class="fa fa-check"></i><b>6</b> Using estimation risk reduction techniques</a>
<ul>
<li class="chapter" data-level="6.1" data-path="somemaths.html"><a href="somemaths.html#quantile-factor-modelling-and-regime-switching"><i class="fa fa-check"></i><b>6.1</b> Quantile factor modelling and regime switching</a></li>
<li class="chapter" data-level="6.2" data-path="somemaths.html"><a href="somemaths.html#ridge-regression"><i class="fa fa-check"></i><b>6.2</b> Ridge regression</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="experiment.html"><a href="experiment.html"><i class="fa fa-check"></i><b>7</b> An empirical test using Sourth African equities</a>
<ul>
<li class="chapter" data-level="7.1" data-path="experiment.html"><a href="experiment.html#data-and-methodology"><i class="fa fa-check"></i><b>7.1</b> Data and methodology</a></li>
<li class="chapter" data-level="7.2" data-path="experiment.html"><a href="experiment.html#results"><i class="fa fa-check"></i><b>7.2</b> Results</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="experiment.html"><a href="experiment.html#going-to-rify"><i class="fa fa-check"></i><b>7.2.1</b> going to R’ify</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="rbportch.html"><a href="rbportch.html#code"><i class="fa fa-check"></i><b>7.3</b> Code</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="experiment.html"><a href="experiment.html#data-reading-in-and-cleaning"><i class="fa fa-check"></i><b>7.3.1</b> Data reading in and cleaning</a></li>
<li class="chapter" data-level="7.3.2" data-path="experiment.html"><a href="experiment.html#data-preparation-sample-window-history-adjustment"><i class="fa fa-check"></i><b>7.3.2</b> Data preparation (sample window history adjustment)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>8</b> Conclusion</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conclusion.html"><a href="conclusion.html#avenues-for-further-research"><i class="fa fa-check"></i><b>8.1</b> Avenues for further research</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#appendix-appendix"><i class="fa fa-check"></i>(APPENDIX) Appendix</a>
<ul>
<li class="chapter" data-level="8.2" data-path="conclusion.html"><a href="conclusion.html#mrcapp"><i class="fa fa-check"></i><b>8.2</b> Marginal risk contribution</a></li>
<li class="chapter" data-level="8.3" data-path="conclusion.html"><a href="conclusion.html#ihimax"><i class="fa fa-check"></i><b>8.3</b> Minimum weight constrained IHI</a></li>
<li class="chapter" data-level="8.4" data-path="conclusion.html"><a href="conclusion.html#volineq"><i class="fa fa-check"></i><b>8.4</b> Proof of the volatility order inequality</a></li>
<li class="chapter" data-level="8.5" data-path="conclusion.html"><a href="conclusion.html#msrrbport"><i class="fa fa-check"></i><b>8.5</b> Maximum Sharpe ratio risk-based portfolios</a></li>
<li class="chapter" data-level="8.6" data-path="conclusion.html"><a href="conclusion.html#qfmexample"><i class="fa fa-check"></i><b>8.6</b> Quantile factor modelling example</a></li>
<li class="chapter" data-level="8.7" data-path="conclusion.html"><a href="conclusion.html#etaest"><i class="fa fa-check"></i><b>8.7</b> Estimating the ERC portfolio Lagrangian multiplier</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Flexible risk-based portfolio optimisation
<a href="https://github.com/jhlandman/flex_rb_opt"><em>(Github link)</em></a></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rbportch" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Overview of risk-based portfolios</h1>
<p>There are many types of risk-based portfolios, for a broader analysis refer to <span class="citation">Plessis and Rensburg (<a href="#ref-DV17" role="doc-biblioref">2017</a>)</span>. In this chapter,
we review three risk-based portfolios: the global minimum variance, equal weight and equal risk
contribution portfolios. The risk properties that these portfolios have, the strategies that bear them
out and the conditions under which they perform optimally are all covered.</p>
<div id="risk-based-portfolio-types" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Risk-based portfolio types</h2>
<p>Each risk-based portfolio is optimal in some sense because they all minimise a specific objective risk
function. The nature of the objective function depends on the investor’s risk preferences. In line
with <span class="citation">Markowitz (<a href="#ref-M52" role="doc-biblioref">1952</a>)</span>, a genetic risk metric to minimise is the portfolio variance, as an investor may not be
willing to tolerate large swings in capital value. Setting
<span class="math inline">\(f(\cdot|\textbf{X}) = w^\intercal \Sigma w\)</span> in portfolio optimisation <a href="#eq:genopt">(<strong>??</strong>)</a> yields the
global minimum variance (GMV) portfolio, denoted <span class="math inline">\(w_\textrm{gmv}\)</span>. The objective function is the same
as for the MVO portfolio for an imputed value of <span class="math inline">\(c\)</span>, meaning that the GMV portfolio sits on the
efficient frontier. The GMV portfolio is also the only risk-based portfolio that is always on the
efficient frontier.</p>
<p><span class="citation">Maillard, Roncalli, and Teı̈letche (<a href="#ref-MRT10" role="doc-biblioref">2010</a>)</span> utilise the concept of an asset’s marginal risk contribution (MRC) in a portfolio to perform
risk-based portfolio calculations. It is the sensitivity of the portfolio volatility to the weight of
an asset in a portfolio. Alternative representations of the MRC and an outline of why the weighted sum
of the MRC’s is minimised for the GMV portfolio are shown in appendix <strong>insert appendix ref</strong>. Below
is the mathematical definition of the MRC for the <span class="math inline">\(i^{\mathrm{th}}\)</span> asset:
<span class="math display">\[\begin{align}
\frac{\partial}{\partial w_i} \Big [ \sigma(w) \Big ]= \frac{(\Sigma w)_i}{\sqrt{w^\intercal \Sigma w}}.
\end{align}\]</span></p>
<p>When taking the realised portfolio returns as the single risk factor, there is no idiosyncratic risk
present for assets in the portfolio against this factor. Accordingly, the GMV portfolio is the lowest
possible beta portfolio. The GMV portfolio is, therefore, optimal for the investor that always takes
on the least risk at the margin. However, risk has to be estimated, so the investor only knows what
the least risky options available to them are in a historical sense. The downside is that always
choosing the lowest marginal risk contributing asset is implicitly displaying a high level of
confidence in estimations of risk.</p>
<p>Contrastingly, the investor may be at a loss when estimating risk. The only measure of diversification
for such an investor is weight diversification. To minimise their risk taken at the margin, this
investor would hold the smallest possible weight in each of the assets while still satisfying the
constraints. This strategy ensures that the investor avoids the maximum marginal risk contributing
asset to the greatest extent possible given that they are unsure which of the <span class="math inline">\(N\)</span> assets it is. The
least weight concentrated portfolio that this strategy alludes to is the equal weight (EW) portfolio:</p>
<p><span class="math display">\[\begin{align}
w_{ew} &amp; = \Big [\frac{1}{N} \; \cdot \cdot \cdot \frac{1}{N} \Big ]^\intercal \; ,
\end{align}\]</span></p>
<p>where the weight diversification measure that this portfolio maximises is the inverse Herfindahl index
(IHI), calculated as <span class="math inline">\(H^{-1} (w) = (\sum_{i = 1}^N w_i^2)^{-1}\)</span>. The most weight concentrated
portfolio is the single asset portfolio - where a single non-zero asset weight is <span class="math inline">\(1\)</span>. The IHI of this
portfolio is <span class="math inline">\(1\)</span>, which is as low as it can be. On the other hand, the EW portfolio has an IHI value
of <span class="math inline">\(N\)</span>. All portfolios, therefore, have an IHI on the interval <span class="math inline">\([1, N]\)</span>. In the presence of a maximum
weight constraint, the lower bound of the interval changes. The new lower bound is derived in appendix
<strong>insert appendix ref</strong>. To find the EW portfolio using framework <a href="#eq:genopt">(<strong>??</strong>)</a>, set the objective
function to the Herfindahl index, <span class="math inline">\(f(\cdot|\textbf{X}) = \sum_{i = 1}^N w_i^2\)</span>. No parameters in the
objective function require estimation, so this is a sample return independent optimisation, which
reflects the investor’s lack of confidence in historical data.</p>
<p>The GMV and EW portfolios represent two extremes of investors, specifically those that value
volatility reduction only and those that value weight diversification only. The inequality
<span class="math inline">\(\sigma(w_{gmv}) \leq \sigma(w^\diamond) \leq \sigma(w_{ew})\)</span> verifies this intuition. The portfolio
<span class="math inline">\(w^\diamond\)</span> has intermediate weight concentration. Proof of the inequality is given in appendix
<strong>insert appendix ref</strong>. It is unlikely that a capital allocator will completely disregard one
risk-based approach for another. One method to construct a sound intermediate portfolio that
incorporates the MRC philosophy from the GMV portfolio construction and the high risk-asset avoidance
philosophy from the EW portfolio construction is to equalise the total risk contribution (TRC) from
each asset. An asset’s TRC is the product of its MRC and its weight in the portfolio:
<span class="math display">\[\begin{align*}
\text{TRC}_i &amp;= w_i \cdot \frac{\partial}{\partial w_i} \Big [ \sigma(w)\Big ], \\
&amp; = \frac{w_i \cdot (\Sigma w)_i}{\sqrt{w^\intercal \Sigma w}},
\end{align*}\]</span>
where TRC’s sum to the portfolio volatility. An equal risk contribution (ERC) portfolio equalises all
of the TRC’s so that no single asset is a comparatively significant contributor to risk. The choice of
<span class="math inline">\(f(\cdot|\textbf{X})\)</span> that minimises the squared distances between the TRC’s to the greatest extent
possible is given below:
<span class="math display">\[\begin{align}
f(w, \Sigma|\textbf{X}) &amp;= \sum_{i = 1}^N  \sum_{j \geq i}^N(w_i(\Sigma w)_i - w_j(\Sigma w)_j)^2 \;\;  .
\end{align}\]</span></p>
<p><span class="citation">Maillard, Roncalli, and Teı̈letche (<a href="#ref-MRT10" role="doc-biblioref">2010</a>)</span> show that a log-constraint on the weights in GMV optimisation could equivalently express this
choice of <span class="math inline">\(f(\cdot| \textbf{X})\)</span> - an idea explored further in appendix <strong>insert appendix ref</strong>.
Therein it is shown that the ERC portfolio is an intermediate portfolio <span class="math inline">\(w^\diamond\)</span>. While there are
several other risk-based portfolios that have been suggested in the literature, we will focus our
attention only on these three portfolios, which are arguably some of the most common risk-based
portfolios seen in practice <span class="citation">Jurczenko, Michel, and Teiletche (<a href="#ref-J13" role="doc-biblioref">2013</a>)</span>.</p>
</div>
<div id="risk-based-portfolio-properties" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Risk-based portfolio properties</h2>
<p>Section <a href="genframework.html#mpt">3.1</a> introduces the Markowitz efficient frontier. <span class="citation">Sharpe (<a href="#ref-S64" role="doc-biblioref">1964</a>)</span> extends this work to deduce that
there is an optimal portfolio called the tangency portfolio. He does make certain assumptions about
investors’ preferences and the presence of a risk-free asset. The market-weighted (MW) portfolio is the
portfolio for which the efficient frontier is tangential to the line bisecting the y-axis at the
risk-free rate (<span class="math inline">\(r_\mathrm{f}\)</span>) in the expected return-volatility plane. The MW portfolio is the
portfolio held by all investors in the market on average and is relevant because it offers the investor
diversification with negligible transaction costs <span class="citation">Perold (<a href="#ref-P07" role="doc-biblioref">2007</a>)</span>. The MW portfolio is not risk-based in the
traditional sense, but it does not require an estimate of expected returns to calculate; hence, the MW
portfolio offers a cheap benchmark against which to compare risk-based portfolio performance. However,
the holder of the MW does implicitly adopt all investors’ weighted expectations of expected returns
<span class="citation">Haugen and Baker (<a href="#ref-H91" role="doc-biblioref">1991</a>)</span>. The tangency portfolio is optimal for the Sharpe ratio (SR) measure under Sharpe’s
assumptions. The measure is defined as:
<span class="math display">\[\begin{align}
\text{SR}_\mathrm{p} = \frac{\mathbb{E}[R_\mathrm{p}] - r_\mathrm{f}}{\mathbb{SD}[R_\mathrm{p}]} \;.
\end{align}\]</span></p>
<p>Within the MVO construction, the MW portfolio has the maximum Sharpe ratio (MSR) and is, therefore, the
MSR portfolio. <span class="citation">Scherer (<a href="#ref-S07" role="doc-biblioref">2007</a>)</span> shows that the MSR portfolio, <span class="math inline">\(w_\mathrm{msr}\)</span>, can alternatively be expressed
as the portfolio for which marginal excess returns and the MRC’s are equal for all portfolio
constituents. <span class="citation">Jurczenko, Michel, and Teiletche (<a href="#ref-J13" role="doc-biblioref">2013</a>)</span> use this fact to find MSR optimality conditions for each of the risk-based
portfolios, some examples of which are shown in appendix <strong>insert appendix num</strong>.</p>
<p>Table <a href="rbportch.html#tab:rbportprops">4.1</a> summarises the salient risk properties of the EW, ERC, and GMV
portfolios. Included is the strategy to find the portfolio, the requirements for when the portfolio
coincides with the MSR portfolio, and their empirical risk characteristics. The risk characteristics
entail whether the risk is inherent to the investment, the construction of the portfolio, or liquidity
restrictions when creating the portfolio.</p>
<table>
<caption><span id="tab:rbportprops">Table 4.1: </span> Risk-based investing portfolio properties <span class="citation">Jurczenko, Michel, and Teiletche (<a href="#ref-J13" role="doc-biblioref">2013</a>)</span></caption>
<colgroup>
<col width="6%" />
<col width="10%" />
<col width="44%" />
<col width="38%" />
</colgroup>
<thead>
<tr class="header">
<th>Portfolio</th>
<th>Strategy</th>
<th>MSR conditions</th>
<th>Risk characteristics</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>EW</td>
<td>Equalise <span class="math inline">\(w_i\)</span></td>
<td>Identical excess returns. Identical volatilities. Identical correlations.</td>
<td>Medium to high risk. Insensitive to <span class="math inline">\(\Sigma\)</span>. Low turnover.</td>
</tr>
<tr class="even">
<td>ERC</td>
<td>Equalise <span class="math inline">\(TRC_i\)</span></td>
<td>Identical Sharpe ratios. Identical correlations.</td>
<td>Medium risk. Moderately sensitive to <span class="math inline">\(\Sigma\)</span>. Medium turnover.</td>
</tr>
<tr class="odd">
<td>GMV</td>
<td>Equalise <span class="math inline">\(MRC_i\)</span></td>
<td>Identical excess returns.</td>
<td>Lowest risk. Highly sensitive to <span class="math inline">\(\Sigma\)</span>. High turnover.</td>
</tr>
</tbody>
</table>
<p>While the MSR conditions are theoretically compelling, out-of-sample optimality is harder to determine
in practice. <span class="citation">Haugen and Baker (<a href="#ref-H91" role="doc-biblioref">1991</a>)</span> show that portfolios that are superior to the MW portfolio exist when:
short-selling is restricted, investments are taxed, and foreign investors are active market
participants. These portfolios should have the same expected return as the MW portfolio with lower
volatility. Their statement is true even in an `efficient market’. Studies of the historical
performance show that some portfolios outperform others. In these studies, the authors restrict the
asset universe to US equities; hence, their results will not necessarily translate to South Africa.
The hope of introducing risk-based portfolios is to find Haugen and Baker’s superior portfolios.
Evidence supporting this ambition exists. <span class="citation">DeMiguel, Garlappi, and Uppal (<a href="#ref-DGL07" role="doc-biblioref">2007</a>)</span> demonstrate the robust out-of-sample
performance of EW portfolios when compared to MVO and MW portfolios for a broad range of asset
universes. <span class="citation">Clarke, De Silva, and Thorley (<a href="#ref-C06" role="doc-biblioref">2006</a>)</span> also demonstrate that GMV portfolios show outperformance against the MW and MVO
benchmarks. They initially attribute this to the diachronic persistence of covariances when compared
to expected returns. In a later paper, <span class="citation">Clarke, De Silva, and Thorley (<a href="#ref-C11" role="doc-biblioref">2011</a>)</span> suggest that the outperformance is due to a bias
inherent in the portfolio construction towards stocks that do not move with the rest of the market,
but that still have comparatively high expected returns.</p>
<p>Within risk-based portfolios, <span class="citation">Kritzman, Page, and Turkington (<a href="#ref-K10" role="doc-biblioref">2010</a>)</span> have shown that GMV portfolios outperform EW portfolios when the
implementer uses a long enough estimation window. Therefore, they establish a defence for using
optimisation on a sample covariance matrix. This research remains consistent with these findings,
using the EW portfolio as a benchmark in pursuit of better out-of-sample performance within the GMV
and ERC frameworks. In the next chapter, we outline the techniques used to achieve this aim.</p>
</div>
<div id="code" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Code</h2>
<div id="mw-portfolio" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> MW portfolio</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="rbportch.html#cb1-1"></a><span class="kw">library</span>(rlang)</span>
<span id="cb1-2"><a href="rbportch.html#cb1-2"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb1-3"><a href="rbportch.html#cb1-3"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-4"><a href="rbportch.html#cb1-4"></a><span class="kw">library</span>(data.table)</span>
<span id="cb1-5"><a href="rbportch.html#cb1-5"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb1-6"><a href="rbportch.html#cb1-6"></a></span>
<span id="cb1-7"><a href="rbportch.html#cb1-7"></a>full_ret &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/full_ret.rds&quot;</span>)</span>
<span id="cb1-8"><a href="rbportch.html#cb1-8"></a></span>
<span id="cb1-9"><a href="rbportch.html#cb1-9"></a>mw_month_rebal &lt;-<span class="st"> </span>full_ret <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-10"><a href="rbportch.html#cb1-10"></a><span class="st">  </span><span class="kw">group_by</span>(.data<span class="op">$</span>month_index) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-11"><a href="rbportch.html#cb1-11"></a><span class="st">    </span><span class="kw">filter</span>(.data<span class="op">$</span>date <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-12"><a href="rbportch.html#cb1-12"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-13"><a href="rbportch.html#cb1-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">top40_ret_contrib =</span> .data<span class="op">$</span>month_ret <span class="op">*</span><span class="st"> </span>.data<span class="op">$</span>top40_weight) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-14"><a href="rbportch.html#cb1-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">top100_ret_contrib =</span> .data<span class="op">$</span>month_ret <span class="op">*</span><span class="st"> </span>.data<span class="op">$</span>top100_weight) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-15"><a href="rbportch.html#cb1-15"></a><span class="st">  </span><span class="kw">group_by</span>(.data<span class="op">$</span>month_index) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-16"><a href="rbportch.html#cb1-16"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">top40_total_ret =</span> <span class="kw">sum</span>(.data<span class="op">$</span>top40_ret_contrib)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-17"><a href="rbportch.html#cb1-17"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">top100_total_ret =</span> <span class="kw">sum</span>(.data<span class="op">$</span>top100_ret_contrib)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-18"><a href="rbportch.html#cb1-18"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-19"><a href="rbportch.html#cb1-19"></a><span class="st">    </span><span class="kw">select</span>(</span>
<span id="cb1-20"><a href="rbportch.html#cb1-20"></a>      .data<span class="op">$</span>month_index, </span>
<span id="cb1-21"><a href="rbportch.html#cb1-21"></a>      .data<span class="op">$</span>name, </span>
<span id="cb1-22"><a href="rbportch.html#cb1-22"></a>      .data<span class="op">$</span>month_ret, </span>
<span id="cb1-23"><a href="rbportch.html#cb1-23"></a>      .data<span class="op">$</span>top40_weight,</span>
<span id="cb1-24"><a href="rbportch.html#cb1-24"></a>      .data<span class="op">$</span>top40_ret_contrib,</span>
<span id="cb1-25"><a href="rbportch.html#cb1-25"></a>      .data<span class="op">$</span>top40_total_ret,</span>
<span id="cb1-26"><a href="rbportch.html#cb1-26"></a>      .data<span class="op">$</span>top100_weight,</span>
<span id="cb1-27"><a href="rbportch.html#cb1-27"></a>      .data<span class="op">$</span>top100_ret_contrib,</span>
<span id="cb1-28"><a href="rbportch.html#cb1-28"></a>      .data<span class="op">$</span>top100_total_ret</span>
<span id="cb1-29"><a href="rbportch.html#cb1-29"></a>    )</span>
<span id="cb1-30"><a href="rbportch.html#cb1-30"></a></span>
<span id="cb1-31"><a href="rbportch.html#cb1-31"></a><span class="kw">saveRDS</span>(mw_month_rebal, <span class="dt">file =</span> <span class="st">&quot;data/port_out/mw_month_rebal.rds&quot;</span>)</span>
<span id="cb1-32"><a href="rbportch.html#cb1-32"></a><span class="kw">head</span>(mw_month_rebal)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##   month_index name  month_ret top40_weight top40_ret_contrib top40_total_ret top100_weight top100_ret_contrib top100_total_ret
##         &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt;             &lt;dbl&gt;           &lt;dbl&gt;         &lt;dbl&gt;              &lt;dbl&gt;            &lt;dbl&gt;
## 1      199602 ABI      0.0133            0                 0         -0.0315     0.00104            0.0000139          -0.0292
## 2      199602 AXL      0.0436            0                 0         -0.0315     0                  0                  -0.0292
## 3      199602 ACL      0.0218            0                 0         -0.0315     0                  0                  -0.0292
## 4      199602 ACT      0.0833            0                 0         -0.0315     0                  0                  -0.0292
## 5      199602 ADR      0.250             0                 0         -0.0315     0.0000499          0.0000125          -0.0292
## 6      199602 AEL     -0.265             0                 0         -0.0315     0                  0                  -0.0292</code></pre>
</div>
<div id="ew-portfolio" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> EW portfolio</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="rbportch.html#cb3-1"></a><span class="kw">library</span>(rlang)</span>
<span id="cb3-2"><a href="rbportch.html#cb3-2"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb3-3"><a href="rbportch.html#cb3-3"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb3-4"><a href="rbportch.html#cb3-4"></a><span class="kw">library</span>(data.table)</span>
<span id="cb3-5"><a href="rbportch.html#cb3-5"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb3-6"><a href="rbportch.html#cb3-6"></a></span>
<span id="cb3-7"><a href="rbportch.html#cb3-7"></a>full_ret &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/full_ret.rds&quot;</span>)</span>
<span id="cb3-8"><a href="rbportch.html#cb3-8"></a></span>
<span id="cb3-9"><a href="rbportch.html#cb3-9"></a>ew_month_rebal &lt;-<span class="st"> </span>full_ret <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-10"><a href="rbportch.html#cb3-10"></a><span class="st">  </span><span class="kw">group_by</span>(.data<span class="op">$</span>month_index) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-11"><a href="rbportch.html#cb3-11"></a><span class="st">    </span><span class="kw">filter</span>(.data<span class="op">$</span>date <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-12"><a href="rbportch.html#cb3-12"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-13"><a href="rbportch.html#cb3-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ew40_weight =</span> <span class="kw">if_else</span>(.data<span class="op">$</span>top40_weight <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">40</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-14"><a href="rbportch.html#cb3-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ew100_weight =</span> <span class="kw">if_else</span>(.data<span class="op">$</span>top100_weight <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-15"><a href="rbportch.html#cb3-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ew40_ret_contrib =</span> .data<span class="op">$</span>month_ret <span class="op">*</span><span class="st"> </span>.data<span class="op">$</span>ew40_weight) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-16"><a href="rbportch.html#cb3-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ew100_ret_contrib =</span> .data<span class="op">$</span>month_ret <span class="op">*</span><span class="st"> </span>.data<span class="op">$</span>ew100_weight) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-17"><a href="rbportch.html#cb3-17"></a><span class="st">  </span><span class="kw">group_by</span>(.data<span class="op">$</span>month_index) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-18"><a href="rbportch.html#cb3-18"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">ew40_total_ret =</span> <span class="kw">sum</span>(.data<span class="op">$</span>ew40_ret_contrib)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-19"><a href="rbportch.html#cb3-19"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">ew100_total_ret =</span> <span class="kw">sum</span>(.data<span class="op">$</span>ew100_ret_contrib)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-20"><a href="rbportch.html#cb3-20"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-21"><a href="rbportch.html#cb3-21"></a><span class="st">    </span><span class="kw">select</span>(</span>
<span id="cb3-22"><a href="rbportch.html#cb3-22"></a>      .data<span class="op">$</span>month_index, </span>
<span id="cb3-23"><a href="rbportch.html#cb3-23"></a>      .data<span class="op">$</span>name, </span>
<span id="cb3-24"><a href="rbportch.html#cb3-24"></a>      .data<span class="op">$</span>month_ret, </span>
<span id="cb3-25"><a href="rbportch.html#cb3-25"></a>      .data<span class="op">$</span>ew40_weight,</span>
<span id="cb3-26"><a href="rbportch.html#cb3-26"></a>      .data<span class="op">$</span>ew40_ret_contrib,</span>
<span id="cb3-27"><a href="rbportch.html#cb3-27"></a>      .data<span class="op">$</span>ew40_total_ret,</span>
<span id="cb3-28"><a href="rbportch.html#cb3-28"></a>      .data<span class="op">$</span>ew100_weight,</span>
<span id="cb3-29"><a href="rbportch.html#cb3-29"></a>      .data<span class="op">$</span>ew100_ret_contrib,</span>
<span id="cb3-30"><a href="rbportch.html#cb3-30"></a>      .data<span class="op">$</span>ew100_total_ret</span>
<span id="cb3-31"><a href="rbportch.html#cb3-31"></a>    )</span>
<span id="cb3-32"><a href="rbportch.html#cb3-32"></a></span>
<span id="cb3-33"><a href="rbportch.html#cb3-33"></a><span class="kw">saveRDS</span>(ew_month_rebal, <span class="dt">file =</span> <span class="st">&quot;data/port_out/ew_month_rebal.rds&quot;</span>)</span>
<span id="cb3-34"><a href="rbportch.html#cb3-34"></a><span class="kw">head</span>(ew_month_rebal)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##   month_index name  month_ret ew40_weight ew40_ret_contrib ew40_total_ret ew100_weight ew100_ret_contrib ew100_total_ret
##         &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;             &lt;dbl&gt;           &lt;dbl&gt;
## 1      199602 ABI      0.0133           0                0        -0.0314         0.01          0.000133        -0.00955
## 2      199602 AXL      0.0436           0                0        -0.0314         0             0               -0.00955
## 3      199602 ACL      0.0218           0                0        -0.0314         0             0               -0.00955
## 4      199602 ACT      0.0833           0                0        -0.0314         0             0               -0.00955
## 5      199602 ADR      0.250            0                0        -0.0314         0.01          0.00250         -0.00955
## 6      199602 AEL     -0.265            0                0        -0.0314         0             0               -0.00955</code></pre>
</div>
<div id="gmv-portfolio" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> GMV portfolio</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="rbportch.html#cb5-1"></a><span class="kw">library</span>(rlang)</span>
<span id="cb5-2"><a href="rbportch.html#cb5-2"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb5-3"><a href="rbportch.html#cb5-3"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb5-4"><a href="rbportch.html#cb5-4"></a><span class="kw">library</span>(data.table)</span>
<span id="cb5-5"><a href="rbportch.html#cb5-5"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb5-6"><a href="rbportch.html#cb5-6"></a><span class="kw">library</span>(purrr)</span>
<span id="cb5-7"><a href="rbportch.html#cb5-7"></a><span class="kw">library</span>(matrixNormal)</span>
<span id="cb5-8"><a href="rbportch.html#cb5-8"></a><span class="kw">library</span>(Matrix)</span>
<span id="cb5-9"><a href="rbportch.html#cb5-9"></a><span class="kw">library</span>(quadprog)</span>
<span id="cb5-10"><a href="rbportch.html#cb5-10"></a></span>
<span id="cb5-11"><a href="rbportch.html#cb5-11"></a>model_rebal_dat &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/model_rebal_dat.rds&quot;</span>)</span>
<span id="cb5-12"><a href="rbportch.html#cb5-12"></a>full_ret &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/full_ret.rds&quot;</span>)</span>
<span id="cb5-13"><a href="rbportch.html#cb5-13"></a>alpha =<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb5-14"><a href="rbportch.html#cb5-14"></a>sum_w =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb5-15"><a href="rbportch.html#cb5-15"></a></span>
<span id="cb5-16"><a href="rbportch.html#cb5-16"></a><span class="co"># Helper functions ---------------------------------------------------------------------------------</span></span>
<span id="cb5-17"><a href="rbportch.html#cb5-17"></a></span>
<span id="cb5-18"><a href="rbportch.html#cb5-18"></a>get_cov &lt;-<span class="st"> </span><span class="cf">function</span>(chopped_df) {</span>
<span id="cb5-19"><a href="rbportch.html#cb5-19"></a>  out &lt;-<span class="st"> </span>chopped_df <span class="op">%&gt;%</span></span>
<span id="cb5-20"><a href="rbportch.html#cb5-20"></a><span class="st">  </span><span class="kw">select</span>(.data<span class="op">$</span>date, .data<span class="op">$</span>name, .data<span class="op">$</span>week_ret) <span class="op">%&gt;%</span></span>
<span id="cb5-21"><a href="rbportch.html#cb5-21"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">id_cols =</span> <span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;name&quot;</span>), <span class="dt">names_from =</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span>), <span class="dt">values_from =</span> <span class="kw">c</span>(<span class="st">&quot;week_ret&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb5-22"><a href="rbportch.html#cb5-22"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>.data<span class="op">$</span>date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-23"><a href="rbportch.html#cb5-23"></a><span class="st">  </span><span class="kw">cov</span>()</span>
<span id="cb5-24"><a href="rbportch.html#cb5-24"></a>  <span class="kw">return</span>(out)</span>
<span id="cb5-25"><a href="rbportch.html#cb5-25"></a>}</span>
<span id="cb5-26"><a href="rbportch.html#cb5-26"></a></span>
<span id="cb5-27"><a href="rbportch.html#cb5-27"></a>filter_n_size &lt;-<span class="st"> </span><span class="cf">function</span>(df_in, weight_col_name) {</span>
<span id="cb5-28"><a href="rbportch.html#cb5-28"></a>  last_date &lt;-<span class="st"> </span>df_in[df_in<span class="op">$</span>date <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(df_in<span class="op">$</span>date),]</span>
<span id="cb5-29"><a href="rbportch.html#cb5-29"></a>  n_ids &lt;-<span class="st"> </span>last_date[<span class="kw">pull</span>(last_date, weight_col_name) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,]<span class="op">$</span>name</span>
<span id="cb5-30"><a href="rbportch.html#cb5-30"></a>  filtered &lt;-<span class="st"> </span>df_in[df_in<span class="op">$</span>name <span class="op">%in%</span><span class="st"> </span>n_ids,]</span>
<span id="cb5-31"><a href="rbportch.html#cb5-31"></a>  <span class="kw">return</span>(filtered)</span>
<span id="cb5-32"><a href="rbportch.html#cb5-32"></a>}</span>
<span id="cb5-33"><a href="rbportch.html#cb5-33"></a></span>
<span id="cb5-34"><a href="rbportch.html#cb5-34"></a>get_gmv_weights &lt;-<span class="st"> </span><span class="cf">function</span>(Dmat_in){</span>
<span id="cb5-35"><a href="rbportch.html#cb5-35"></a>  <span class="cf">if</span> (matrixNormal<span class="op">::</span><span class="kw">is.positive.definite</span>(Dmat_in)) {</span>
<span id="cb5-36"><a href="rbportch.html#cb5-36"></a>    Dmat &lt;-<span class="st"> </span>Dmat_in</span>
<span id="cb5-37"><a href="rbportch.html#cb5-37"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-38"><a href="rbportch.html#cb5-38"></a>    Dmat &lt;-<span class="st"> </span>Matrix<span class="op">::</span><span class="kw">nearPD</span>(Dmat_in)<span class="op">$</span>mat</span>
<span id="cb5-39"><a href="rbportch.html#cb5-39"></a>    <span class="kw">print</span>(<span class="st">&quot;used  a near positive definite matrix&quot;</span>)</span>
<span id="cb5-40"><a href="rbportch.html#cb5-40"></a>  }</span>
<span id="cb5-41"><a href="rbportch.html#cb5-41"></a>  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(Dmat)</span>
<span id="cb5-42"><a href="rbportch.html#cb5-42"></a>  dvec &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dt">times =</span> n), <span class="dt">nrow =</span> n, <span class="dt">ncol=</span><span class="dv">1</span>)</span>
<span id="cb5-43"><a href="rbportch.html#cb5-43"></a>  A.Equality &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>), <span class="dt">times =</span> n), <span class="dt">ncol=</span><span class="dv">1</span>)</span>
<span id="cb5-44"><a href="rbportch.html#cb5-44"></a>  Amat &lt;-<span class="st"> </span><span class="kw">cbind</span>(A.Equality, <span class="kw">diag</span>(n), <span class="op">-</span><span class="kw">diag</span>(n))</span>
<span id="cb5-45"><a href="rbportch.html#cb5-45"></a>  bvec &lt;-<span class="st"> </span><span class="kw">c</span>(sum_w, <span class="kw">rep</span>(<span class="dv">0</span>, n), <span class="kw">rep</span>(<span class="op">-</span>alpha, n))</span>
<span id="cb5-46"><a href="rbportch.html#cb5-46"></a>  qp &lt;-<span class="st"> </span><span class="kw">solve.QP</span>(Dmat, dvec, Amat, bvec, <span class="dt">meq=</span><span class="dv">1</span>)</span>
<span id="cb5-47"><a href="rbportch.html#cb5-47"></a>  df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">colnames</span>(Dmat), <span class="dt">weights =</span> qp<span class="op">$</span>solution)</span>
<span id="cb5-48"><a href="rbportch.html#cb5-48"></a>  df<span class="op">$</span>weights[df<span class="op">$</span>weights <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb5-49"><a href="rbportch.html#cb5-49"></a>  <span class="kw">return</span>(df)</span>
<span id="cb5-50"><a href="rbportch.html#cb5-50"></a>}</span>
<span id="cb5-51"><a href="rbportch.html#cb5-51"></a></span>
<span id="cb5-52"><a href="rbportch.html#cb5-52"></a>flatten_out &lt;-<span class="st"> </span><span class="cf">function</span>(list_df_in, names_idx, col_id) {</span>
<span id="cb5-53"><a href="rbportch.html#cb5-53"></a>  <span class="kw">names</span>(list_df_in) &lt;-<span class="st"> </span>names_idx</span>
<span id="cb5-54"><a href="rbportch.html#cb5-54"></a>  df_out &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(list_df_in, <span class="dt">.id =</span> col_id)</span>
<span id="cb5-55"><a href="rbportch.html#cb5-55"></a>  <span class="kw">return</span>(df_out)</span>
<span id="cb5-56"><a href="rbportch.html#cb5-56"></a>}</span>
<span id="cb5-57"><a href="rbportch.html#cb5-57"></a></span>
<span id="cb5-58"><a href="rbportch.html#cb5-58"></a><span class="co"># portfolio optimisation ---------------------------------------------------------------------------</span></span>
<span id="cb5-59"><a href="rbportch.html#cb5-59"></a></span>
<span id="cb5-60"><a href="rbportch.html#cb5-60"></a>covars40 &lt;-<span class="st"> </span><span class="kw">map</span>(model_rebal_dat<span class="op">$</span>data, filter_n_size, <span class="st">&quot;histadj_top40_weight&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-61"><a href="rbportch.html#cb5-61"></a><span class="st">  </span><span class="kw">map</span>(get_cov) </span>
<span id="cb5-62"><a href="rbportch.html#cb5-62"></a></span>
<span id="cb5-63"><a href="rbportch.html#cb5-63"></a><span class="co"># not sure how to get the weights over here</span></span>
<span id="cb5-64"><a href="rbportch.html#cb5-64"></a>weights40 &lt;-<span class="st"> </span>covars40 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-65"><a href="rbportch.html#cb5-65"></a><span class="st">  </span><span class="kw">map</span>(get_gmv_weights) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-66"><a href="rbportch.html#cb5-66"></a><span class="st">  </span><span class="kw">flatten_out</span>(model_rebal_dat<span class="op">$</span>month_index, <span class="st">&quot;month_index&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-67"><a href="rbportch.html#cb5-67"></a><span class="st">  </span><span class="kw">select</span>(.data<span class="op">$</span>month_index, .data<span class="op">$</span>name, <span class="dt">gmv40_weight =</span> weights) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-68"><a href="rbportch.html#cb5-68"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month_index =</span> <span class="kw">as.integer</span>(.data<span class="op">$</span>month_index))</span>
<span id="cb5-69"><a href="rbportch.html#cb5-69"></a></span>
<span id="cb5-70"><a href="rbportch.html#cb5-70"></a>covars100 &lt;-<span class="st"> </span><span class="kw">map</span>(model_rebal_dat<span class="op">$</span>data, filter_n_size, <span class="st">&quot;histadj_top100_weight&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-71"><a href="rbportch.html#cb5-71"></a><span class="st">  </span><span class="kw">map</span>(get_cov)</span>
<span id="cb5-72"><a href="rbportch.html#cb5-72"></a>weights100 &lt;-<span class="st"> </span>covars100 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-73"><a href="rbportch.html#cb5-73"></a><span class="st">  </span><span class="kw">map</span>(get_gmv_weights) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-74"><a href="rbportch.html#cb5-74"></a><span class="st">  </span><span class="kw">flatten_out</span>(model_rebal_dat<span class="op">$</span>month_index, <span class="st">&quot;month_index&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-75"><a href="rbportch.html#cb5-75"></a><span class="st">  </span><span class="kw">select</span>(.data<span class="op">$</span>month_index, .data<span class="op">$</span>name, <span class="dt">gmv100_weight =</span> weights) <span class="op">%&gt;%</span></span>
<span id="cb5-76"><a href="rbportch.html#cb5-76"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month_index =</span> <span class="kw">as.integer</span>(.data<span class="op">$</span>month_index))</span>
<span id="cb5-77"><a href="rbportch.html#cb5-77"></a></span>
<span id="cb5-78"><a href="rbportch.html#cb5-78"></a>gmv_month_rebal &lt;-<span class="st"> </span>full_ret <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-79"><a href="rbportch.html#cb5-79"></a><span class="st">  </span><span class="kw">group_by</span>(.data<span class="op">$</span>month_index, .data<span class="op">$</span>name) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-80"><a href="rbportch.html#cb5-80"></a><span class="st">  </span><span class="kw">filter</span>(.data<span class="op">$</span>date <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(.data<span class="op">$</span>date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-81"><a href="rbportch.html#cb5-81"></a><span class="st">  </span><span class="kw">left_join</span>(weights40, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;month_index&#39;</span>, <span class="st">&#39;name&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-82"><a href="rbportch.html#cb5-82"></a><span class="st">  </span><span class="kw">left_join</span>(weights100, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;month_index&#39;</span>, <span class="st">&#39;name&#39;</span>))</span>
<span id="cb5-83"><a href="rbportch.html#cb5-83"></a></span>
<span id="cb5-84"><a href="rbportch.html#cb5-84"></a>min_period &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">as.integer</span>(weights40<span class="op">$</span>month_index))</span>
<span id="cb5-85"><a href="rbportch.html#cb5-85"></a></span>
<span id="cb5-86"><a href="rbportch.html#cb5-86"></a>gmv_month_rebal &lt;-<span class="st"> </span>gmv_month_rebal <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-87"><a href="rbportch.html#cb5-87"></a><span class="st">  </span><span class="kw">filter</span>(.data<span class="op">$</span>month_index <span class="op">&gt;=</span><span class="st"> </span>min_period) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-88"><a href="rbportch.html#cb5-88"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gmv40_weight =</span> data.table<span class="op">::</span><span class="kw">nafill</span>(.data<span class="op">$</span>gmv40_weight, <span class="dt">fill =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-89"><a href="rbportch.html#cb5-89"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gmv100_weight =</span> data.table<span class="op">::</span><span class="kw">nafill</span>(.data<span class="op">$</span>gmv100_weight, <span class="dt">fill =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-90"><a href="rbportch.html#cb5-90"></a><span class="st">  </span><span class="kw">select</span>(</span>
<span id="cb5-91"><a href="rbportch.html#cb5-91"></a>    .data<span class="op">$</span>month_index, </span>
<span id="cb5-92"><a href="rbportch.html#cb5-92"></a>    .data<span class="op">$</span>name, </span>
<span id="cb5-93"><a href="rbportch.html#cb5-93"></a>    .data<span class="op">$</span>month_ret, </span>
<span id="cb5-94"><a href="rbportch.html#cb5-94"></a>    .data<span class="op">$</span>gmv40_weight,</span>
<span id="cb5-95"><a href="rbportch.html#cb5-95"></a>    .data<span class="op">$</span>gmv100_weight,</span>
<span id="cb5-96"><a href="rbportch.html#cb5-96"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-97"><a href="rbportch.html#cb5-97"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gmv40_ret_contrib =</span> .data<span class="op">$</span>month_ret <span class="op">*</span><span class="st"> </span>.data<span class="op">$</span>gmv40_weight) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-98"><a href="rbportch.html#cb5-98"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gmv100_ret_contrib =</span> .data<span class="op">$</span>month_ret <span class="op">*</span><span class="st"> </span>.data<span class="op">$</span>gmv100_weight) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-99"><a href="rbportch.html#cb5-99"></a><span class="st">  </span><span class="kw">group_by</span>(.data<span class="op">$</span>month_index) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-100"><a href="rbportch.html#cb5-100"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">gmv40_total_ret =</span> <span class="kw">sum</span>(.data<span class="op">$</span>gmv40_ret_contrib)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-101"><a href="rbportch.html#cb5-101"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">gmv100_total_ret =</span> <span class="kw">sum</span>(.data<span class="op">$</span>gmv100_ret_contrib)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-102"><a href="rbportch.html#cb5-102"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb5-103"><a href="rbportch.html#cb5-103"></a></span>
<span id="cb5-104"><a href="rbportch.html#cb5-104"></a><span class="kw">saveRDS</span>(gmv_month_rebal, <span class="dt">file =</span> <span class="st">&quot;data/port_out/gmv_month_rebal.rds&quot;</span>)</span>
<span id="cb5-105"><a href="rbportch.html#cb5-105"></a><span class="kw">head</span>(gmv_month_rebal)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##   month_index name  month_ret gmv40_weight gmv100_weight gmv40_ret_contrib gmv100_ret_contrib gmv40_total_ret gmv100_total_ret
##         &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;              &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
## 1      200310 ABI      0.0400     0.            1.35e- 2          0.                 5.39e- 4          0.0504           0.0921
## 2      200310 AXL      0.138      5.71e-20      0.                7.88e-21           0.                0.0504           0.0921
## 3      200310 ACL      0.133      0.            1.14e-17          0.                 1.51e-18          0.0504           0.0921
## 4      200310 ACP      0.121      0.            0.                0.                 0.                0.0504           0.0921
## 5      200310 ACT      0          0.            0.                0.                 0.                0.0504           0.0921
## 6      200310 ADH      0.109      0.            0.                0.                 0.                0.0504           0.0921</code></pre>
</div>
<div id="erc-portfolio" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> ERC portfolio</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="rbportch.html#cb7-1"></a><span class="kw">library</span>(rlang)</span>
<span id="cb7-2"><a href="rbportch.html#cb7-2"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb7-3"><a href="rbportch.html#cb7-3"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb7-4"><a href="rbportch.html#cb7-4"></a><span class="kw">library</span>(data.table)</span>
<span id="cb7-5"><a href="rbportch.html#cb7-5"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb7-6"><a href="rbportch.html#cb7-6"></a><span class="kw">library</span>(purrr)</span>
<span id="cb7-7"><a href="rbportch.html#cb7-7"></a><span class="kw">library</span>(matrixNormal)</span>
<span id="cb7-8"><a href="rbportch.html#cb7-8"></a><span class="kw">library</span>(Matrix)</span>
<span id="cb7-9"><a href="rbportch.html#cb7-9"></a><span class="kw">library</span>(quadprog)</span>
<span id="cb7-10"><a href="rbportch.html#cb7-10"></a></span>
<span id="cb7-11"><a href="rbportch.html#cb7-11"></a>model_rebal_dat &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/model_rebal_dat.rds&quot;</span>)</span>
<span id="cb7-12"><a href="rbportch.html#cb7-12"></a>full_ret &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/full_ret.rds&quot;</span>)</span>
<span id="cb7-13"><a href="rbportch.html#cb7-13"></a>alpha =<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb7-14"><a href="rbportch.html#cb7-14"></a>sum_w =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb7-15"><a href="rbportch.html#cb7-15"></a></span>
<span id="cb7-16"><a href="rbportch.html#cb7-16"></a><span class="co"># Helper functions ---------------------------------------------------------------------------------</span></span>
<span id="cb7-17"><a href="rbportch.html#cb7-17"></a></span>
<span id="cb7-18"><a href="rbportch.html#cb7-18"></a>get_cov &lt;-<span class="st"> </span><span class="cf">function</span>(chopped_df) {</span>
<span id="cb7-19"><a href="rbportch.html#cb7-19"></a>  out &lt;-<span class="st"> </span>chopped_df <span class="op">%&gt;%</span></span>
<span id="cb7-20"><a href="rbportch.html#cb7-20"></a><span class="st">  </span><span class="kw">select</span>(.data<span class="op">$</span>date, .data<span class="op">$</span>name, .data<span class="op">$</span>week_ret) <span class="op">%&gt;%</span></span>
<span id="cb7-21"><a href="rbportch.html#cb7-21"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">id_cols =</span> <span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;name&quot;</span>), <span class="dt">names_from =</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span>), <span class="dt">values_from =</span> <span class="kw">c</span>(<span class="st">&quot;week_ret&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb7-22"><a href="rbportch.html#cb7-22"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>.data<span class="op">$</span>date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-23"><a href="rbportch.html#cb7-23"></a><span class="st">  </span><span class="kw">cov</span>()</span>
<span id="cb7-24"><a href="rbportch.html#cb7-24"></a>  <span class="kw">return</span>(out)</span>
<span id="cb7-25"><a href="rbportch.html#cb7-25"></a>}</span>
<span id="cb7-26"><a href="rbportch.html#cb7-26"></a></span>
<span id="cb7-27"><a href="rbportch.html#cb7-27"></a>filter_n_size &lt;-<span class="st"> </span><span class="cf">function</span>(df_in, weight_col_name) {</span>
<span id="cb7-28"><a href="rbportch.html#cb7-28"></a>  last_date &lt;-<span class="st"> </span>df_in[df_in<span class="op">$</span>date <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(df_in<span class="op">$</span>date),]</span>
<span id="cb7-29"><a href="rbportch.html#cb7-29"></a>  n_ids &lt;-<span class="st"> </span>last_date[<span class="kw">pull</span>(last_date, weight_col_name) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,]<span class="op">$</span>name</span>
<span id="cb7-30"><a href="rbportch.html#cb7-30"></a>  filtered &lt;-<span class="st"> </span>df_in[df_in<span class="op">$</span>name <span class="op">%in%</span><span class="st"> </span>n_ids,]</span>
<span id="cb7-31"><a href="rbportch.html#cb7-31"></a>  <span class="kw">return</span>(filtered)</span>
<span id="cb7-32"><a href="rbportch.html#cb7-32"></a>}</span>
<span id="cb7-33"><a href="rbportch.html#cb7-33"></a></span>
<span id="cb7-34"><a href="rbportch.html#cb7-34"></a><span class="co"># portfolio optimisation ---------------------------------------------------------------------------</span></span>
<span id="cb7-35"><a href="rbportch.html#cb7-35"></a></span>
<span id="cb7-36"><a href="rbportch.html#cb7-36"></a>covars40 &lt;-<span class="st"> </span><span class="kw">map</span>(model_rebal_dat<span class="op">$</span>data, filter_n_size, <span class="st">&quot;histadj_top40_weight&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-37"><a href="rbportch.html#cb7-37"></a><span class="st">  </span><span class="kw">map</span>(get_cov) </span></code></pre></div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-C11">
<p>Clarke, Roger, Harindra De Silva, and Steven Thorley. 2011. “Minimum-Variance Portfolio Composition.” <em>The Journal of Portfolio Management</em> 37 (2): 31–45.</p>
</div>
<div id="ref-C06">
<p>Clarke, Roger G, Harindra De Silva, and Steven Thorley. 2006. “Minimum-Variance Portfolios in the Us Equity Market.” <em>The Journal of Portfolio Management</em> 33 (1): 10–24.</p>
</div>
<div id="ref-DGL07">
<p>DeMiguel, Victor, Lorenzo Garlappi, and Raman Uppal. 2007. “Optimal Versus Naive Diversification: How Inefficient Is the 1/N Portfolio Strategy?” <em>The Review of Financial Studies</em> 22 (5): 1915–53.</p>
</div>
<div id="ref-H91">
<p>Haugen, Robert A, and Nardin L Baker. 1991. “The Efficient Market Inefficiency of Capitalization–Weighted Stock Portfolios.” <em>The Journal of Portfolio Management</em> 17 (3): 35–40.</p>
</div>
<div id="ref-J13">
<p>Jurczenko, Emmanuel, Thierry Michel, and Jerome Teiletche. 2013. “Generalized Risk-Based Investing.” <em>Available at SSRN 2205979</em>.</p>
</div>
<div id="ref-K10">
<p>Kritzman, Mark, Sébastien Page, and David Turkington. 2010. “In Defense of Optimization: The Fallacy of 1/N.” <em>Financial Analysts Journal</em> 66 (2): 31–39.</p>
</div>
<div id="ref-MRT10">
<p>Maillard, Sébastien, Thierry Roncalli, and Jérôme Teı̈letche. 2010. “The Properties of Equally Weighted Risk Contribution Portfolios.” <em>The Journal of Portfolio Management</em> 36 (4): 60–70.</p>
</div>
<div id="ref-M52">
<p>Markowitz, Harry. 1952. “Portfolio Selection.” <em>The Journal of Finance</em> 7 (1): 77–91.</p>
</div>
<div id="ref-P07">
<p>Perold, André F. 2007. “Fundamentally Flawed Indexing.” <em>Financial Analysts Journal</em> 63 (6): 31–37.</p>
</div>
<div id="ref-DV17">
<p>Plessis, Hannes du, and Paul van Rensburg. 2017. “Diversification and the Realised Volatility of Equity Portfolios.” <em>Investment Analysts Journal</em> 46 (3): 213–34.</p>
</div>
<div id="ref-S07">
<p>Scherer, Bernd. 2007. “Can Robust Portfolio Optimisation Help to Build Better Portfolios?” <em>Journal of Asset Management</em> 7 (6): 374–87.</p>
</div>
<div id="ref-S64">
<p>Sharpe, William F. 1964. “Capital Asset Prices: A Theory of Market Equilibrium Under Conditions of Risk.” <em>The Journal of Finance</em> 19 (3): 425–42.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="genframework.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="estriskreduce.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="book_assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "night",
"family": "sans",
"size": 14
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
